---
phase: 05-c-api-naming-error-standardization
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - include/quiver/c/database.h
  - include/quiver/c/element.h
  - src/c/database_create.cpp
  - src/c/database_read.cpp
  - src/c/database_metadata.cpp
  - src/c/database_time_series.cpp
  - src/c/element.cpp
  - tests/test_c_api_database_delete.cpp
  - tests/test_c_api_database_create.cpp
  - tests/test_c_api_database_read.cpp
  - tests/test_c_api_database_update.cpp
  - tests/test_c_api_database_lifecycle.cpp
  - tests/test_c_api_database_time_series.cpp
  - tests/test_c_api_element.cpp
  - tests/test_c_api_lua_runner.cpp
autonomous: true

must_haves:
  truths:
    - "Every C API function follows quiver_{entity}_{operation} naming -- no bare quiver_free_* or quiver_string_free remain"
    - "quiver_database_delete_element_by_id is renamed to quiver_database_delete_element"
    - "All C API tests compile and pass after renaming"
  artifacts:
    - path: "include/quiver/c/database.h"
      provides: "Renamed declarations for 13 functions (1 delete + 12 free)"
      contains: "quiver_database_free_integer_array"
    - path: "include/quiver/c/element.h"
      provides: "Renamed declaration for quiver_element_free_string"
      contains: "quiver_element_free_string"
  key_links:
    - from: "include/quiver/c/database.h"
      to: "src/c/database_read.cpp"
      via: "function declaration matches definition"
      pattern: "quiver_database_free_integer_array"
    - from: "include/quiver/c/database.h"
      to: "tests/test_c_api_database_read.cpp"
      via: "test call sites use new names"
      pattern: "quiver_database_free_integer_array"
    - from: "include/quiver/c/element.h"
      to: "tests/test_c_api_element.cpp"
      via: "test call sites use new name"
      pattern: "quiver_element_free_string"
---

<objective>
Rename 14 C API functions to follow the `quiver_{entity}_{operation}` naming convention, and update all C API implementation files and test call sites.

Purpose: Establish consistent naming across the C API layer. The 12 `quiver_free_*` functions need `database_` entity prefix, `quiver_database_delete_element_by_id` drops the `_by_id` suffix (matching Phase 3 C++ rename), and `quiver_string_free` becomes `quiver_element_free_string`.

Output: Renamed C API headers, implementations, and tests that compile and pass.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-c-api-naming-error-standardization/05-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rename 14 functions in C API headers and implementation files</name>
  <files>
    include/quiver/c/database.h
    include/quiver/c/element.h
    src/c/database_create.cpp
    src/c/database_read.cpp
    src/c/database_metadata.cpp
    src/c/database_time_series.cpp
    src/c/element.cpp
  </files>
  <action>
Apply the following 14 renames in C API header declarations AND their corresponding implementation files. Each rename is a mechanical find-and-replace of the old function name with the new one.

**In include/quiver/c/database.h and src/c/database_create.cpp:**
- `quiver_database_delete_element_by_id` -> `quiver_database_delete_element`

**In include/quiver/c/element.h and src/c/element.cpp:**
- `quiver_string_free` -> `quiver_element_free_string`
- Also update the comment above the declaration in element.h that says "quiver_string_free" to say "quiver_element_free_string"

**In include/quiver/c/database.h and src/c/database_read.cpp (6 functions):**
- `quiver_free_integer_array` -> `quiver_database_free_integer_array`
- `quiver_free_float_array` -> `quiver_database_free_float_array`
- `quiver_free_string_array` -> `quiver_database_free_string_array`
- `quiver_free_integer_vectors` -> `quiver_database_free_integer_vectors`
- `quiver_free_float_vectors` -> `quiver_database_free_float_vectors`
- `quiver_free_string_vectors` -> `quiver_database_free_string_vectors`

**In include/quiver/c/database.h and src/c/database_metadata.cpp (4 functions):**
- `quiver_free_scalar_metadata` -> `quiver_database_free_scalar_metadata`
- `quiver_free_group_metadata` -> `quiver_database_free_group_metadata`
- `quiver_free_scalar_metadata_array` -> `quiver_database_free_scalar_metadata_array`
- `quiver_free_group_metadata_array` -> `quiver_database_free_group_metadata_array`

**In include/quiver/c/database.h and src/c/database_time_series.cpp (2 functions):**
- `quiver_free_time_series_data` -> `quiver_database_free_time_series_data`
- `quiver_free_time_series_files` -> `quiver_database_free_time_series_files`

After all renames, grep the ENTIRE repository for each old name to verify no stale references remain (excluding .planning/ and .md files which contain documentation).
  </action>
  <verify>
Run: `grep -r "quiver_free_integer_array\|quiver_free_float_array\|quiver_free_string_array\|quiver_free_integer_vectors\|quiver_free_float_vectors\|quiver_free_string_vectors\|quiver_free_scalar_metadata\|quiver_free_group_metadata\|quiver_free_time_series_data\|quiver_free_time_series_files\|quiver_string_free\|quiver_database_delete_element_by_id" --include="*.h" --include="*.cpp" include/ src/`

Must return zero matches.
  </verify>
  <done>All 14 function names are updated in C API headers (database.h, element.h) and implementation files (database_create.cpp, database_read.cpp, database_metadata.cpp, database_time_series.cpp, element.cpp). No stale old names remain in include/ or src/ directories.</done>
</task>

<task type="auto">
  <name>Task 2: Update all C API test files to use new function names</name>
  <files>
    tests/test_c_api_database_delete.cpp
    tests/test_c_api_database_create.cpp
    tests/test_c_api_database_read.cpp
    tests/test_c_api_database_update.cpp
    tests/test_c_api_database_lifecycle.cpp
    tests/test_c_api_database_time_series.cpp
    tests/test_c_api_element.cpp
    tests/test_c_api_lua_runner.cpp
  </files>
  <action>
Update all 8 C API test files to use the new function names. These are mechanical renames -- the function signatures and behavior are unchanged, only the names change.

**test_c_api_database_delete.cpp:** Replace all `quiver_database_delete_element_by_id` with `quiver_database_delete_element`. Also replace `quiver_free_integer_array` with `quiver_database_free_integer_array`, `quiver_free_string_array` with `quiver_database_free_string_array`.

**test_c_api_database_create.cpp:** Replace `quiver_free_string_array` with `quiver_database_free_string_array`.

**test_c_api_database_read.cpp:** Replace all `quiver_free_*` calls with `quiver_database_free_*` equivalents. This file has the most free function calls (~20+). Also replace `quiver_free_scalar_metadata`, `quiver_free_scalar_metadata_array` with their `quiver_database_` prefixed versions.

**test_c_api_database_update.cpp:** Replace `quiver_free_integer_array`, `quiver_free_float_array`, `quiver_free_string_array` with `quiver_database_free_*` versions.

**test_c_api_database_lifecycle.cpp:** Replace `quiver_database_delete_element_by_id` with `quiver_database_delete_element`. Replace `quiver_free_string_array`, `quiver_free_integer_array` with `quiver_database_free_*`.

**test_c_api_database_time_series.cpp:** Replace `quiver_free_group_metadata`, `quiver_free_group_metadata_array`, `quiver_free_time_series_data`, `quiver_free_time_series_files`, `quiver_free_string_array` with their `quiver_database_free_*` versions.

**test_c_api_element.cpp:** Replace `quiver_string_free` with `quiver_element_free_string`.

**test_c_api_lua_runner.cpp:** Replace `quiver_free_integer_array`, `quiver_free_string_array`, `quiver_free_integer_vectors` with their `quiver_database_free_*` versions.

After all renames, build and run the C API test suite.
  </action>
  <verify>
1. `grep -r "quiver_free_integer_array\|quiver_free_float_array\|quiver_free_string_array\|quiver_free_integer_vectors\|quiver_free_float_vectors\|quiver_free_string_vectors\|quiver_free_scalar_metadata\|quiver_free_group_metadata\|quiver_free_time_series_data\|quiver_free_time_series_files\|quiver_string_free\|quiver_database_delete_element_by_id" --include="*.cpp" tests/` -- must return zero matches.
2. `cmake --build build --config Debug` -- must succeed.
3. `./build/bin/quiver_c_tests.exe` -- all tests pass.
4. `./build/bin/quiver_tests.exe` -- all C++ tests still pass (no regression).
  </verify>
  <done>All 8 C API test files use new function names. Build succeeds. All C API tests pass. All C++ tests pass (no regression).</done>
</task>

</tasks>

<verification>
1. Zero occurrences of old function names in include/, src/, and tests/ directories (excluding .md files)
2. `cmake --build build --config Debug` succeeds
3. `./build/bin/quiver_c_tests.exe` -- all tests pass
4. `./build/bin/quiver_tests.exe` -- all tests pass
</verification>

<success_criteria>
- All 14 C API functions renamed in headers, implementations, and tests
- No stale references to old names in C/C++ source files
- Full C API test suite passes
- Full C++ test suite passes (no regression)
</success_criteria>

<output>
After completion, create `.planning/phases/05-c-api-naming-error-standardization/05-01-SUMMARY.md`
</output>
