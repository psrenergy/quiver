---
phase: 03-cpp-naming-error-standardization
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - include/quiver/database.h
  - src/database_delete.cpp
  - src/database_relations.cpp
  - src/database_describe.cpp
  - src/database_time_series.cpp
  - src/lua_runner.cpp
  - tests/test_database_delete.cpp
  - tests/test_database_relations.cpp
  - tests/test_database_errors.cpp
  - tests/test_database_create.cpp
  - tests/test_database_update.cpp
  - tests/test_database_time_series.cpp
  - tests/test_lua_runner.cpp
autonomous: true

must_haves:
  truths:
    - "Every public method on Database follows verb_noun or verb_adjective_noun naming"
    - "No two methods use different naming styles for the same kind of operation"
    - "All C++ tests pass after renaming"
    - "Lua binding C++ call sites updated but Lua-facing string names unchanged"
  artifacts:
    - path: "include/quiver/database.h"
      provides: "Renamed method declarations"
      contains: "delete_element|update_scalar_relation|export_csv|import_csv|read_time_series_group"
    - path: "src/database_delete.cpp"
      provides: "Renamed delete_element definition"
      contains: "Database::delete_element"
    - path: "src/database_relations.cpp"
      provides: "Renamed update_scalar_relation definition"
      contains: "Database::update_scalar_relation"
  key_links:
    - from: "include/quiver/database.h"
      to: "src/database_delete.cpp"
      via: "declaration matches definition"
      pattern: "delete_element"
    - from: "src/lua_runner.cpp"
      to: "include/quiver/database.h"
      via: "C++ method calls"
      pattern: "self\\.delete_element\\(|self\\.update_scalar_relation\\("
---

<objective>
Rename the 5 C++ public methods that deviate from the established `verb_[category]_[type]` naming convention. Update all downstream C++ call sites: implementation files, lua_runner.cpp C++ calls (keeping Lua-facing string names for Phase 8), and all test files.

Purpose: Establish uniform naming across all 60 Database methods so that downstream phases (C API Phase 5, Lua Phase 8) inherit a clean, consistent base.
Output: All method names follow the documented convention; all C++ tests pass.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-cpp-naming-error-standardization/03-RESEARCH.md
@include/quiver/database.h
@src/database_delete.cpp
@src/database_relations.cpp
@src/database_describe.cpp
@src/database_time_series.cpp
@src/lua_runner.cpp
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rename 5 methods in declarations, definitions, and all C++ call sites</name>
  <files>
    include/quiver/database.h
    src/database_delete.cpp
    src/database_relations.cpp
    src/database_describe.cpp
    src/database_time_series.cpp
    src/lua_runner.cpp
    tests/test_database_delete.cpp
    tests/test_database_relations.cpp
    tests/test_database_errors.cpp
    tests/test_database_create.cpp
    tests/test_database_update.cpp
    tests/test_database_time_series.cpp
    tests/test_lua_runner.cpp
  </files>
  <action>
    Apply these 5 renames across the codebase. For each rename, update: (1) declaration in database.h, (2) definition in src/*.cpp, (3) all test call sites, (4) lua_runner.cpp C++ method calls.

    **Rename 1: `delete_element_by_id` -> `delete_element`**
    - database.h: Change declaration
    - src/database_delete.cpp: Change `Database::delete_element_by_id` to `Database::delete_element`
    - src/lua_runner.cpp: Change `self.delete_element_by_id(` to `self.delete_element(` but KEEP the Lua-facing string `"delete_element_by_id"` unchanged (Phase 8 handles Lua names)
    - tests/test_database_delete.cpp: Update all `delete_element_by_id` calls
    - tests/test_database_errors.cpp: Update all `delete_element_by_id` calls
    - tests/test_database_create.cpp: Check for and update any calls
    - tests/test_database_update.cpp: Check for and update any calls

    **Rename 2: `set_scalar_relation` -> `update_scalar_relation`**
    - database.h: Change declaration
    - src/database_relations.cpp: Change `Database::set_scalar_relation` to `Database::update_scalar_relation`
    - src/lua_runner.cpp: Change `self.set_scalar_relation(` to `self.update_scalar_relation(` but KEEP Lua string `"set_scalar_relation"` unchanged
    - tests/test_database_relations.cpp: Update all `set_scalar_relation` calls

    **Rename 3: `export_to_csv` -> `export_csv`**
    - database.h: Change declaration
    - src/database_describe.cpp: Change `Database::export_to_csv` to `Database::export_csv`
    - No test files reference these (stubs)
    - Check lua_runner.cpp for any references

    **Rename 4: `import_from_csv` -> `import_csv`**
    - database.h: Change declaration
    - src/database_describe.cpp: Change `Database::import_from_csv` to `Database::import_csv`
    - No test files reference these (stubs)
    - Check lua_runner.cpp for any references

    **Rename 5: `read_time_series_group_by_id` -> `read_time_series_group`**
    - database.h: Change declaration
    - src/database_time_series.cpp: Change `Database::read_time_series_group_by_id` to `Database::read_time_series_group`
    - src/lua_runner.cpp: Change `db.read_time_series_group_by_id(` to `db.read_time_series_group(` in the helper function, but KEEP Lua-facing string `"read_time_series_group_by_id"` and helper function name `read_time_series_group_by_id_to_lua` unchanged (Phase 8)
    - tests/test_database_time_series.cpp: Update all `read_time_series_group_by_id` calls

    **IMPORTANT**: Do NOT rename any C API functions (src/c/*.cpp, include/quiver/c/*.h). Do NOT rename Lua-facing string literals in lua_runner.cpp. Only rename C++ method names and their direct C++ call sites.

    After all renames, search the entire `src/` and `tests/` directories for any remaining references to the old names to catch stragglers.
  </action>
  <verify>
    1. `grep -r "delete_element_by_id" include/quiver/database.h src/database_*.cpp tests/test_database_*.cpp` returns zero hits (C++ layer clean of old name). C API files (src/c/, tests/test_c_api_*, include/quiver/c/) and lua_runner.cpp Lua strings are expected to retain old names.
    2. `grep -r "set_scalar_relation" include/quiver/database.h src/database_*.cpp tests/test_database_*.cpp` returns zero hits.
    3. `grep -r "export_to_csv\|import_from_csv" include/quiver/database.h src/database_*.cpp` returns zero hits.
    4. `grep -r "read_time_series_group_by_id" include/quiver/database.h src/database_*.cpp tests/test_database_*.cpp` returns zero hits.
    5. Build succeeds: `cmake --build build --config Debug`
    6. C++ tests pass: `./build/bin/quiver_tests.exe`
  </verify>
  <done>
    All 5 method renames applied. Zero references to old names remain in C++ layer (database.h, src/database_*.cpp, tests/). Lua-facing strings preserved for Phase 8. C API untouched for Phase 5. Build and all C++ tests pass.
  </done>
</task>

</tasks>

<verification>
1. Build: `cmake --build build --config Debug` succeeds with zero errors
2. C++ tests: `./build/bin/quiver_tests.exe` all pass
3. Naming audit: Every public method in database.h follows verb_noun or verb_adjective_noun pattern. Specifically:
   - All reads use `read_` prefix
   - All updates use `update_` prefix (including former `set_scalar_relation`)
   - All deletes use `delete_` prefix (without extraneous `_by_id`)
   - CSV operations use `export_csv`/`import_csv` (no prepositions)
   - Time series read has no `_by_id` suffix (matches update variant)
</verification>

<success_criteria>
- database.h contains `delete_element`, `update_scalar_relation`, `export_csv`, `import_csv`, `read_time_series_group` (no old names)
- All C++ tests pass
- No stale references to old method names in src/database_*.cpp or tests/
</success_criteria>

<output>
After completion, create `.planning/phases/03-cpp-naming-error-standardization/03-01-SUMMARY.md`
</output>
