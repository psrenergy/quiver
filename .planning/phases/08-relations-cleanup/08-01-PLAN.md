---
phase: 08-relations-cleanup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - bindings/python/src/quiverdb/database.py
  - bindings/python/src/quiverdb/_declarations.py
  - bindings/python/generator/generator.py
  - bindings/python/tests/test_database_read_scalar.py
autonomous: true
requirements: [REL-01]
must_haves:
  truths:
    - "Database class has no read_scalar_relation method"
    - "Database class has no update_scalar_relation method"
    - "_declarations.py has no phantom relation declarations"
    - "All existing Python tests pass after removal"
  artifacts:
    - path: "bindings/python/src/quiverdb/database.py"
      provides: "Database class without relation convenience methods"
      contains: "# -- Vector reads"
    - path: "bindings/python/src/quiverdb/_declarations.py"
      provides: "Clean CFFI declarations matching actual C headers"
      contains: "Auto-generated CFFI declarations"
    - path: "bindings/python/generator/generator.py"
      provides: "Generator with corrected header paths"
      contains: "include/quiver/c/"
    - path: "bindings/python/tests/test_database_read_scalar.py"
      provides: "Read scalar tests without TestReadScalarRelation class"
  key_links:
    - from: "bindings/python/generator/generator.py"
      to: "include/quiver/c/"
      via: "HEADERS path list"
      pattern: "include/quiver/c/"
    - from: "bindings/python/src/quiverdb/_declarations.py"
      to: "include/quiver/c/database.h"
      via: "generator output"
      pattern: "quiver_database_create_element"
---

<objective>
Remove deprecated pure-Python relation convenience methods and clean up phantom C API declarations.

Purpose: Align Python Database class with C++/Julia/Dart pattern where FK operations go through standard create_element/update_element/read_scalar_integer_by_id. Remove dead code per project philosophy ("Delete unused code, do not deprecate").
Output: Clean Database class, regenerated _declarations.py, no old relation test class.
</objective>

<execution_context>
@C:/Users/rsampaio/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/rsampaio/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-relations-cleanup/08-CONTEXT.md
@.planning/phases/08-relations-cleanup/08-RESEARCH.md
@bindings/python/src/quiverdb/database.py
@bindings/python/src/quiverdb/_declarations.py
@bindings/python/generator/generator.py
@bindings/python/tests/test_database_read_scalar.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove relation methods, fix generator, regenerate declarations</name>
  <files>
    bindings/python/src/quiverdb/database.py
    bindings/python/generator/generator.py
    bindings/python/src/quiverdb/_declarations.py
    bindings/python/tests/test_database_read_scalar.py
  </files>
  <action>
1. In `bindings/python/src/quiverdb/database.py`: Delete the entire "Relation operations" section (lines 539-595), which includes `update_scalar_relation()` and `read_scalar_relation()` methods plus the section comment. The line after removal should transition directly from the `read_element_ids` method to the "Vector reads (bulk)" section.

2. In `bindings/python/generator/generator.py`: Fix the HEADERS list (line 19-24). Change all paths from `include/quiverdb/c/` to `include/quiver/c/`:
   - `include/quiverdb/c/common.h` -> `include/quiver/c/common.h`
   - `include/quiverdb/c/options.h` -> `include/quiver/c/options.h`
   - `include/quiverdb/c/database.h` -> `include/quiver/c/database.h`
   - `include/quiverdb/c/element.h` -> `include/quiver/c/element.h`

3. Regenerate `_declarations.py` by running:
   ```
   cd bindings/python && python generator/generator.py --output src/quiverdb/_declarations.py
   ```
   This will produce a clean declarations file from the actual C headers, automatically removing the phantom `quiver_database_update_scalar_relation` and `quiver_database_read_scalar_relation` declarations (lines 127-138 of the old file) since those functions do not exist in the C headers.

4. In `bindings/python/tests/test_database_read_scalar.py`: Delete the entire `TestReadScalarRelation` class (lines 137-174), including the section comment "# -- Scalar relation reads" above it. The transition should go directly from `TestReadElementIds` to "# -- DateTime scalar reads".

5. Verify no other Python files reference `read_scalar_relation` or `update_scalar_relation` by searching the bindings/python directory. If any stale imports or references exist in `__init__.py` or other files, remove them.
  </action>
  <verify>
    <automated>cd C:/Development/DatabaseTmp/quiver && bindings/python/test/test.bat</automated>
    <manual>Confirm database.py has no relation methods, _declarations.py has no phantom declarations, test_database_read_scalar.py has no TestReadScalarRelation class</manual>
  </verify>
  <done>
    - database.py: No update_scalar_relation or read_scalar_relation methods exist
    - _declarations.py: Regenerated from actual C headers, no phantom relation declarations
    - generator.py: HEADERS list uses correct include/quiver/c/ paths
    - test_database_read_scalar.py: No TestReadScalarRelation class
    - All existing Python tests pass (zero regressions)
  </done>
</task>

</tasks>

<verification>
1. `bindings/python/test/test.bat` passes with all tests green
2. `grep -r "read_scalar_relation\|update_scalar_relation" bindings/python/src/` returns no matches
3. `grep -r "TestReadScalarRelation" bindings/python/tests/` returns no matches
4. `grep "quiver_database_read_scalar_relation\|quiver_database_update_scalar_relation" bindings/python/src/quiverdb/_declarations.py` returns no matches
</verification>

<success_criteria>
- Python Database class has exactly zero relation convenience methods
- _declarations.py is cleanly generated from actual C headers (no phantom functions)
- generator.py header paths point to include/quiver/c/ (not include/quiverdb/c/)
- All pre-existing Python tests pass without modification (except deleted relation tests)
</success_criteria>

<output>
After completion, create `.planning/phases/08-relations-cleanup/08-01-SUMMARY.md`
</output>
