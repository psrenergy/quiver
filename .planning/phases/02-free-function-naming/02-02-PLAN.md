---
phase: 02-free-function-naming
plan: 02
type: execute
wave: 2
depends_on:
  - "02-01"
files_modified:
  - bindings/julia/src/database_read.jl
  - bindings/julia/src/database_query.jl
  - bindings/julia/src/element.jl
  - bindings/dart/lib/src/database_read.dart
  - bindings/dart/lib/src/database_query.dart
  - bindings/python/src/quiverdb/_c_api.py
  - bindings/python/src/quiverdb/database.py
  - bindings/python/src/quiverdb/element.py
  - CLAUDE.md
autonomous: true
requirements:
  - NAME-01
  - NAME-02
must_haves:
  truths:
    - "All Julia hand-written files call C.quiver_database_free_string instead of C.quiver_element_free_string"
    - "All Dart hand-written files call bindings.quiver_database_free_string instead of bindings.quiver_element_free_string"
    - "Python _c_api.py declares quiver_database_free_string and does not declare quiver_element_free_string"
    - "Python database.py and element.py call lib.quiver_database_free_string instead of lib.quiver_element_free_string"
    - "Zero occurrences of quiver_element_free_string exist in the entire codebase outside .planning/"
    - "All five test suites (C++, C API, Julia, Dart, Python) pass"
    - "CLAUDE.md Memory Management section references quiver_database_free_string(char*)"
  artifacts:
    - path: "bindings/julia/src/database_query.jl"
      provides: "Julia query string free calls updated"
      contains: "quiver_database_free_string"
    - path: "bindings/dart/lib/src/database_query.dart"
      provides: "Dart query string free calls updated"
      contains: "quiver_database_free_string"
    - path: "bindings/python/src/quiverdb/_c_api.py"
      provides: "Python CFFI cdef with quiver_database_free_string"
      contains: "quiver_database_free_string"
    - path: "CLAUDE.md"
      provides: "Updated documentation"
      contains: "quiver_database_free_string"
  key_links:
    - from: "bindings/julia/src/database_read.jl"
      to: "bindings/julia/src/c_api.jl"
      via: "C.quiver_database_free_string call"
      pattern: "quiver_database_free_string"
    - from: "bindings/dart/lib/src/database_read.dart"
      to: "bindings/dart/lib/src/ffi/bindings.dart"
      via: "bindings.quiver_database_free_string call"
      pattern: "quiver_database_free_string"
    - from: "bindings/python/src/quiverdb/database.py"
      to: "bindings/python/src/quiverdb/_c_api.py"
      via: "lib.quiver_database_free_string call"
      pattern: "quiver_database_free_string"
---

<objective>
Update all hand-written binding files (Julia, Dart, Python) to call `quiver_database_free_string` instead of `quiver_element_free_string`, update CLAUDE.md documentation, and validate the complete rename by running all five test suites.

Purpose: Complete the cross-layer rename started in Plan 01. After this plan, zero traces of `quiver_element_free_string` remain in the codebase, and all bindings correctly free database-returned strings through the entity-scoped function.

Output: 8 updated binding files, 1 updated documentation file. All five test suites (C++, C API, Julia, Dart, Python) pass.
</objective>

<execution_context>
@C:/Users/rsampaio/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/rsampaio/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-free-function-naming/02-CONTEXT.md
@.planning/phases/02-free-function-naming/02-RESEARCH.md
@.planning/phases/02-free-function-naming/02-01-SUMMARY.md

<interfaces>
<!-- Julia call sites (quiver_element_free_string -> quiver_database_free_string): -->
<!-- bindings/julia/src/database_read.jl line 242: -->
```julia
C.quiver_element_free_string(out_value[])
```

<!-- bindings/julia/src/database_query.jl lines 62, 129: -->
```julia
C.quiver_element_free_string(out_value[])  # line 62
C.quiver_element_free_string(out_value[])  # line 129
```

<!-- bindings/julia/src/element.jl line 106: -->
```julia
C.quiver_element_free_string(out_string[])
```

<!-- Dart call sites (quiver_element_free_string -> quiver_database_free_string): -->
<!-- bindings/dart/lib/src/database_read.dart line 485: -->
```dart
bindings.quiver_element_free_string(outValue.value)
```

<!-- bindings/dart/lib/src/database_query.dart lines 29, 131: -->
```dart
bindings.quiver_element_free_string(outValue.value)  // line 29
bindings.quiver_element_free_string(outValue.value)  // line 131
```

<!-- Python call sites (lib.quiver_element_free_string -> lib.quiver_database_free_string): -->
<!-- bindings/python/src/quiverdb/database.py lines 243, 503: -->
```python
lib.quiver_element_free_string(out_value[0])  # line 243
lib.quiver_element_free_string(out_value[0])  # line 503
```

<!-- bindings/python/src/quiverdb/element.py line 120: -->
```python
lib.quiver_element_free_string(out_string[0])
```

<!-- Python _c_api.py cdef (line 90): -->
```python
quiver_error_t quiver_element_free_string(char* str);
```

<!-- CLAUDE.md Memory Management section contains: -->
```
quiver_element_free_string(char*)
```
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update all hand-written binding files to use quiver_database_free_string</name>
  <files>
    bindings/julia/src/database_read.jl
    bindings/julia/src/database_query.jl
    bindings/julia/src/element.jl
    bindings/dart/lib/src/database_read.dart
    bindings/dart/lib/src/database_query.dart
    bindings/python/src/quiverdb/_c_api.py
    bindings/python/src/quiverdb/database.py
    bindings/python/src/quiverdb/element.py
  </files>
  <action>
All changes are mechanical find-and-replace within each file. Every occurrence of the old function name is replaced with the new one. The transformation per binding:

**Julia (3 files):**

1. `bindings/julia/src/database_read.jl` (1 call site, line ~242):
   - Replace `C.quiver_element_free_string` with `C.quiver_database_free_string`

2. `bindings/julia/src/database_query.jl` (2 call sites, lines ~62, ~129):
   - Replace all `C.quiver_element_free_string` with `C.quiver_database_free_string`

3. `bindings/julia/src/element.jl` (1 call site, line ~106):
   - Replace `C.quiver_element_free_string` with `C.quiver_database_free_string`

**Dart (2 files):**

4. `bindings/dart/lib/src/database_read.dart` (1 call site, line ~485):
   - Replace `bindings.quiver_element_free_string` with `bindings.quiver_database_free_string`

5. `bindings/dart/lib/src/database_query.dart` (2 call sites, lines ~29, ~131):
   - Replace all `bindings.quiver_element_free_string` with `bindings.quiver_database_free_string`

**Python (3 files):**

6. `bindings/python/src/quiverdb/_c_api.py` (cdef section, line ~90):
   - Remove the line: `quiver_error_t quiver_element_free_string(char* str);`
   - Add in the database free functions section (near other `quiver_database_free_*` declarations): `quiver_error_t quiver_database_free_string(char* str);`

7. `bindings/python/src/quiverdb/database.py` (2 call sites, lines ~243, ~503):
   - Replace all `lib.quiver_element_free_string` with `lib.quiver_database_free_string`

8. `bindings/python/src/quiverdb/element.py` (1 call site, line ~120):
   - Replace `lib.quiver_element_free_string` with `lib.quiver_database_free_string`

**Total: 9 call sites across 7 files + 1 cdef add/remove in _c_api.py = 8 files.**

After all changes, run a global search to confirm zero remaining references:
```bash
grep -r "quiver_element_free_string" bindings/ --include="*.jl" --include="*.dart" --include="*.py"
```
Must return zero results.
  </action>
  <verify>
    <automated>grep -r "quiver_element_free_string" bindings/ --include="*.jl" --include="*.dart" --include="*.py" | wc -l</automated>
  </verify>
  <done>All 9 call sites across 8 hand-written binding files now use quiver_database_free_string. Python _c_api.py cdef declares quiver_database_free_string and does not declare quiver_element_free_string. Zero occurrences of the old name remain in binding files.</done>
</task>

<task type="auto">
  <name>Task 2: Update CLAUDE.md and run full test suite to validate the complete rename</name>
  <files>
    CLAUDE.md
  </files>
  <action>
**CLAUDE.md** -- Update the Memory Management section:

Find the line containing `quiver_element_free_string(char*)` and replace it with `quiver_database_free_string(char*)`. This appears in the Memory Management subsection under "C API Patterns" where free functions are listed.

Also search CLAUDE.md for any other references to `quiver_element_free_string` and replace them with `quiver_database_free_string`. The "Element entity free function" comment line should be updated to reflect that `quiver_database_free_string` is now used for strings returned by element/query operations.

**Final codebase-wide verification** -- Confirm complete removal:

```bash
grep -r "quiver_element_free_string" --include="*.h" --include="*.cpp" --include="*.jl" --include="*.dart" --include="*.py" --include="*.md" . | grep -v ".planning/"
```

Must return zero results (only `.planning/` research docs may reference the old name).

**Run all five test suites:**

```bash
scripts/test-all.bat
```

All five suites (C++, C API, Julia, Dart, Python) must pass. If any binding test fails with a symbol-not-found error, it indicates a missed call site -- go back and fix.
  </action>
  <verify>
    <automated>scripts/test-all.bat 2>&1 | tail -20</automated>
  </verify>
  <done>CLAUDE.md references quiver_database_free_string. Zero traces of quiver_element_free_string remain outside .planning/. All five test suites pass.</done>
</task>

</tasks>

<verification>
1. `grep -r "quiver_element_free_string" --include="*.h" --include="*.cpp" --include="*.jl" --include="*.dart" --include="*.py" --include="*.md" . | grep -v ".planning/"` returns zero matches
2. `grep "quiver_database_free_string" bindings/julia/src/database_read.jl bindings/julia/src/database_query.jl bindings/julia/src/element.jl` returns matches in all 3 files
3. `grep "quiver_database_free_string" bindings/dart/lib/src/database_read.dart bindings/dart/lib/src/database_query.dart` returns matches in both files
4. `grep "quiver_database_free_string" bindings/python/src/quiverdb/_c_api.py bindings/python/src/quiverdb/database.py bindings/python/src/quiverdb/element.py` returns matches in all 3 files
5. `grep "quiver_database_free_string" CLAUDE.md` returns a match
6. `scripts/test-all.bat` -- all five test suites pass
</verification>

<success_criteria>
- `grep -r "quiver_element_free_string" . | grep -v ".planning/"` returns zero matches
- `scripts/test-all.bat` completes with all five test suites passing
- CLAUDE.md Memory Management section lists `quiver_database_free_string(char*)` instead of `quiver_element_free_string(char*)`
</success_criteria>

<output>
After completion, create `.planning/phases/02-free-function-naming/02-02-SUMMARY.md`
</output>
