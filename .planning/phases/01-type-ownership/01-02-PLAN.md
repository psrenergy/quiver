---
phase: 01-type-ownership
plan: 02
type: execute
wave: 2
depends_on:
  - 01-01
files_modified:
  - tests/test_database_create.cpp
  - tests/test_database_read.cpp
  - tests/test_database_update.cpp
  - tests/test_database_errors.cpp
  - tests/test_database_time_series.cpp
  - tests/test_database_query.cpp
  - tests/test_database_transaction.cpp
  - tests/test_database_lifecycle.cpp
  - tests/test_database_delete.cpp
  - tests/test_database_csv_import.cpp
  - tests/test_database_csv_export.cpp
  - tests/test_schema_validator.cpp
  - tests/test_lua_runner.cpp
  - tests/test_migrations.cpp
  - tests/test_row_result.cpp
  - tests/sandbox/sandbox.cpp
  - tests/benchmark/benchmark.cpp
autonomous: true
requirements:
  - TYPES-01

must_haves:
  truths:
    - "All C++ test files use quiver::LogLevel::Off instead of QUIVER_LOG_OFF"
    - "All C++ test files use bool false instead of int 0 for read_only"
    - "No C++ test file includes quiver/c/options.h (C API tests are unchanged)"
    - "All C++ core tests pass (quiver_tests.exe exits 0)"
    - "All C API tests pass (quiver_c_tests.exe exits 0)"
    - "Bindings are completely untouched"
  artifacts:
    - path: "tests/test_database_read.cpp"
      provides: "Largest C++ test file with updated initializers"
      contains: "quiver::LogLevel::Off"
    - path: "tests/test_database_create.cpp"
      provides: "Second-largest C++ test file with updated initializers"
      contains: "quiver::LogLevel::Off"
  key_links:
    - from: "tests/test_database_*.cpp"
      to: "include/quiver/options.h"
      via: "DatabaseOptions designated initializer"
      pattern: "\\.console_level = quiver::LogLevel::Off"
---

<objective>
Mechanically update all C++ test files to use the new C++ DatabaseOptions type with `bool read_only` and `enum class LogLevel` instead of the old C API types.

Purpose: After Plan 01 changed DatabaseOptions from a C typedef to a proper C++ struct, all C++ test designated initializers `{.read_only = 0, .console_level = QUIVER_LOG_OFF}` fail to compile. This plan applies the mechanical find-and-replace across all 17 affected files (216 occurrences).

Output: All C++ test files compile and pass. Full test suite (C++ and C API) passes. Phase 1 success criteria are fully met.
</objective>

<execution_context>
@C:/Users/rsampaio/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/rsampaio/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-type-ownership/01-01-SUMMARY.md

<interfaces>
<!-- New C++ types from Plan 01 (include/quiver/options.h): -->
```cpp
namespace quiver {
enum class LogLevel { Debug = 0, Info = 1, Warn = 2, Error = 3, Off = 4 };
struct QUIVER_API DatabaseOptions {
    bool read_only = false;
    LogLevel console_level = LogLevel::Info;
};
}
```

<!-- Old pattern (216 occurrences across 17 C++ test files): -->
```cpp
{.read_only = 0, .console_level = QUIVER_LOG_OFF}
```

<!-- New pattern (replacement): -->
```cpp
{.read_only = false, .console_level = quiver::LogLevel::Off}
```
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace all C++ test DatabaseOptions initializers</name>
  <files>
    tests/test_database_create.cpp
    tests/test_database_read.cpp
    tests/test_database_update.cpp
    tests/test_database_errors.cpp
    tests/test_database_time_series.cpp
    tests/test_database_query.cpp
    tests/test_database_transaction.cpp
    tests/test_database_lifecycle.cpp
    tests/test_database_delete.cpp
    tests/test_database_csv_import.cpp
    tests/test_database_csv_export.cpp
    tests/test_schema_validator.cpp
    tests/test_lua_runner.cpp
    tests/test_migrations.cpp
    tests/test_row_result.cpp
    tests/sandbox/sandbox.cpp
    tests/benchmark/benchmark.cpp
  </files>
  <action>
Perform a single mechanical find-and-replace across ALL 17 files listed above.

**Find:** `{.read_only = 0, .console_level = QUIVER_LOG_OFF}`
**Replace:** `{.read_only = false, .console_level = quiver::LogLevel::Off}`

Every occurrence in these files uses the exact same pattern -- there are no variations with different log levels or `read_only = 1` in C++ test files. This is a pure text substitution with 216 occurrences across 17 files.

**Important constraints:**
- Do NOT touch any `test_c_api_*.cpp` files -- those are C API tests that correctly use C types.
- Do NOT touch any files under `bindings/` -- those use C types via FFI.
- Do NOT modify any `#include` directives in test files.
- Use the Edit tool with `replace_all: true` on each file for efficiency.

**Occurrence counts by file (for verification):**
- test_database_read.cpp: 47
- test_database_update.cpp: 36
- test_database_errors.cpp: 29
- test_database_create.cpp: 25
- test_database_time_series.cpp: 19
- test_database_query.cpp: 17
- test_lua_runner.cpp: 12
- test_database_transaction.cpp: 8
- test_database_lifecycle.cpp: 6
- test_database_delete.cpp: 5
- test_row_result.cpp: 3
- test_database_csv_import.cpp: 2
- test_migrations.cpp: 2
- benchmark.cpp: 2
- test_database_csv_export.cpp: 1
- test_schema_validator.cpp: 1
- sandbox.cpp: 1
  </action>
  <verify>
    <automated>cmake --build build --config Debug 2>&1 | tail -5</automated>
  </verify>
  <done>All 216 occurrences replaced. Zero instances of QUIVER_LOG_OFF remain in C++ test files (only in C API test files and the C API header itself). Full project builds without errors.</done>
</task>

<task type="auto">
  <name>Task 2: Run full test suite and verify phase success criteria</name>
  <files></files>
  <action>
Run the complete test suite to verify everything passes:

1. Run C++ core tests: `./build/bin/quiver_tests.exe`
2. Run C API tests: `./build/bin/quiver_c_tests.exe`

Both must exit with code 0 and all tests pass.

Then verify phase success criteria:
- `grep "quiver/c/" include/quiver/options.h` returns no matches (zero C API includes)
- `grep "enum class LogLevel" include/quiver/options.h` returns a match
- `grep "default_database_options" include/quiver/options.h include/quiver/database.h` returns no matches
- `grep -r "QUIVER_LOG_OFF" tests/test_database_*.cpp tests/test_schema_validator.cpp tests/test_lua_runner.cpp tests/test_migrations.cpp tests/test_row_result.cpp tests/sandbox/sandbox.cpp tests/benchmark/benchmark.cpp` returns no matches

If any test fails, diagnose and fix. The most likely cause would be a missed occurrence of the old pattern.
  </action>
  <verify>
    <automated>./build/bin/quiver_tests.exe 2>&1 | tail -3 && ./build/bin/quiver_c_tests.exe 2>&1 | tail -3</automated>
  </verify>
  <done>All C++ core tests pass. All C API tests pass. Phase 1 success criteria fully verified: options.h has no C API includes, DatabaseOptions uses enum class LogLevel, CSVOptions is unchanged, all tests pass without modification to C API tests or bindings.</done>
</task>

</tasks>

<verification>
1. `grep -rc "QUIVER_LOG_OFF" tests/test_database_*.cpp tests/test_schema_validator.cpp tests/test_lua_runner.cpp tests/test_migrations.cpp tests/test_row_result.cpp tests/sandbox/sandbox.cpp tests/benchmark/benchmark.cpp` -- all counts must be 0
2. `grep -rc "quiver::LogLevel::Off" tests/test_database_*.cpp tests/test_schema_validator.cpp tests/test_lua_runner.cpp tests/test_migrations.cpp tests/test_row_result.cpp tests/sandbox/sandbox.cpp tests/benchmark/benchmark.cpp` -- sum must equal 216
3. `./build/bin/quiver_tests.exe` exits 0
4. `./build/bin/quiver_c_tests.exe` exits 0
5. No changes to any file under `bindings/`, `tests/test_c_api_*`, or `include/quiver/c/`
</verification>

<success_criteria>
- `cmake --build build --config Debug` succeeds with zero errors
- `./build/bin/quiver_tests.exe` passes all tests
- `./build/bin/quiver_c_tests.exe` passes all tests
- Zero occurrences of `QUIVER_LOG_OFF` in C++ test files
- 216 occurrences of `quiver::LogLevel::Off` in C++ test files (replacing the old pattern)
</success_criteria>

<output>
After completion, create `.planning/phases/01-type-ownership/01-02-SUMMARY.md`
</output>
