---
phase: 14-verification-and-cleanup
plan: 02
type: execute
wave: 2
depends_on:
  - 14-01
files_modified:
  - CLAUDE.md
autonomous: true
requirements:
  - MIGR-02
  - MIGR-03
must_haves:
  truths:
    - "CLAUDE.md documents the multi-column time series API pattern across all layers (C++, C API, Julia, Dart, Lua)"
    - "CLAUDE.md has no references to old single-column time series API patterns that no longer exist"
    - "CLAUDE.md has no hardcoded test counts that will become stale"
    - "All 4 test suites pass via scripts/build-all.bat (C++, C API, Julia, Dart)"
    - "Old single-column C API time series functions are confirmed absent from the codebase"
  artifacts:
    - path: "CLAUDE.md"
      provides: "Updated project documentation with multi-column time series API patterns"
      contains: "update_time_series_group"
  key_links:
    - from: "CLAUDE.md"
      to: "include/quiver/c/database.h"
      via: "C API documentation matches actual header signatures"
      pattern: "quiver_database_update_time_series_group|quiver_database_read_time_series_group"
---

<objective>
Update CLAUDE.md to document the multi-column time series API patterns, remove any stale references to old single-column interfaces, perform a dead code sweep, and run the full test suite as the final gate.

Purpose: Satisfy MIGR-02 (all tests pass) and MIGR-03 (old API removed -- verify and document). Ensure CLAUDE.md accurately reflects the current codebase state after the v1.1 time series migration.
Output: Updated CLAUDE.md, confirmed clean build-all.bat run.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-verification-and-cleanup/14-RESEARCH.md
@.planning/phases/14-verification-and-cleanup/14-01-SUMMARY.md

@CLAUDE.md
@include/quiver/c/database.h
</context>

<tasks>

<task type="auto">
  <name>Task 1: Dead code sweep and old API removal verification</name>
  <files>CLAUDE.md</files>
  <action>
Perform a dead code sweep and verify old single-column C API functions are gone.

**Step 1: Verify old API removal (MIGR-03)**

Grep for old single-column C API function names to confirm they are absent from the entire codebase:
- `quiver_database_read_time_series_floats_by_id`
- `quiver_database_read_time_series_integers_by_id`
- `quiver_database_read_time_series_strings_by_id`
- `quiver_database_update_time_series_floats`
- `quiver_database_update_time_series_integers`
- `quiver_database_update_time_series_strings`
- `quiver_database_free_time_series_result`

If any are found, remove them (unexpected based on research). If none are found (expected), confirm MIGR-03 is satisfied.

**Step 2: Dead code sweep**

Check for potentially dead code beyond time series:
- Grep public C++ header declarations (`include/quiver/`) vs usage in implementation (`src/`) and tests
- Grep C API header declarations (`include/quiver/c/`) vs usage in implementation (`src/c/`) and tests
- Look for unused includes in recently modified files
- Check for helper functions declared but never called

If dead code is found, remove it. If none is found (expected based on research), confirm the codebase is clean.

**Step 3: Update CLAUDE.md**

Read `CLAUDE.md` fully. Make these changes:

a) **Remove any references to old single-column time series API patterns** -- scan for mentions of `read_time_series_floats`, `read_time_series_integers`, `read_time_series_strings`, or other old function names. If any exist, remove them.

b) **Remove any hardcoded test counts** -- search for specific numbers like "1,213", "392", "257", "351", "227" or patterns like "N tests" or "N+ tests". Replace with generic language or remove counts entirely.

c) **Add multi-column time series documentation** to the C API Patterns section. Document the columnar interface pattern:
```
### Multi-Column Time Series
The C API supports N typed value columns for time series update and read:
- `quiver_database_update_time_series_group()` accepts parallel arrays: column_names[], column_types[], column_data[], column_count, row_count
- `quiver_database_read_time_series_group()` returns columnar typed arrays matching schema
- `quiver_database_free_time_series_data()` deallocates read results (string columns: per-element cleanup; numeric columns: single delete[])
```

d) **Add `update_time_series_group` to the cross-layer naming table** if not already present. Verify the existing `read_time_series_group` row is still accurate.

e) **Update the Core API section** if needed to reflect that `update_time_series_group()` accepts `vector<map<string, Value>>` rows (multi-column).

f) **Remove any specific test counts from documentation sections** that would become stale (per user decision).
  </action>
  <verify>
- Grep for old single-column function names returns zero results
- Read updated CLAUDE.md and verify no stale references remain
- Verify no hardcoded test counts exist in CLAUDE.md
- Verify multi-column time series API is documented
  </verify>
  <done>CLAUDE.md is updated with multi-column time series API documentation, no stale single-column references remain, no hardcoded test counts, dead code sweep found no issues (or removed any found).</done>
</task>

<task type="auto">
  <name>Task 2: Full test suite gate via build-all.bat</name>
  <files></files>
  <action>
Run the full build and test suite as the final gate for the v1.1 milestone.

**Step 1:** Run `scripts/build-all.bat` which builds everything and runs all 4 test suites (C++, C API, Julia, Dart).

**Step 2:** Verify the exit code is 0 (all tests pass).

**Step 3:** Note the test counts from output but do NOT hardcode them anywhere.

If any tests fail:
- Investigate the failure
- Fix the issue (likely a test regression from Phase 14 Plan 01 additions)
- Re-run until green

This is the MIGR-02 gate: "All existing tests continue passing throughout migration."
  </action>
  <verify>
`scripts/build-all.bat` exits with code 0. All 4 test suites pass: C++ core, C API, Julia, Dart.
  </verify>
  <done>All test suites pass via scripts/build-all.bat. MIGR-02 is satisfied. v1.1 milestone is complete.</done>
</task>

</tasks>

<verification>
- `scripts/build-all.bat` exits with code 0
- All 4 test suites pass (C++, C API, Julia, Dart)
- CLAUDE.md has no references to old single-column time series functions
- CLAUDE.md documents multi-column time series API patterns
- No dead code remains in the codebase
- Old C API functions are confirmed absent (MIGR-03)
</verification>

<success_criteria>
- scripts/build-all.bat passes all 4 test suites
- CLAUDE.md accurately reflects the current multi-column time series API
- Zero references to old single-column time series API remain in documentation
- Dead code sweep confirms clean codebase
- MIGR-02 (all tests pass) and MIGR-03 (old API removed) are satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/14-verification-and-cleanup/14-02-SUMMARY.md`
</output>
