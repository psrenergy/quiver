---
phase: 01-python-kwargs-api
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - bindings/python/tests/test_database_read_scalar.py
  - bindings/python/tests/test_database_read_vector.py
  - bindings/python/tests/test_database_read_set.py
  - bindings/python/tests/test_database_query.py
  - bindings/python/tests/test_database_transaction.py
  - bindings/python/tests/test_database_csv_export.py
  - bindings/python/tests/test_database_csv_import.py
  - bindings/python/tests/test_database_time_series.py
  - bindings/python/tests/test_database_metadata.py
  - CLAUDE.md
autonomous: true
requirements:
  - PYAPI-04
  - PYAPI-05

must_haves:
  truths:
    - "All Python tests pass with the kwargs API (full test suite green)"
    - "CLAUDE.md cross-layer naming table shows Python kwargs pattern for create/update"
    - "No test file imports Element from the public quiverdb package"
  artifacts:
    - path: "bindings/python/tests/test_database_read_scalar.py"
      provides: "Scalar read tests using kwargs"
      contains: "create_element"
    - path: "bindings/python/tests/test_database_csv_export.py"
      provides: "CSV export tests using kwargs (non-chained pattern converted)"
      contains: "create_element"
    - path: "bindings/python/tests/test_database_time_series.py"
      provides: "Time series tests with helper functions converted"
      contains: "create_element"
    - path: "CLAUDE.md"
      provides: "Updated cross-layer naming table with Python kwargs pattern"
      contains: "create_element.*kwargs"
  key_links:
    - from: "bindings/python/tests/*.py"
      to: "bindings/python/src/quiverdb/database.py"
      via: "kwargs-based create_element/update_element calls"
      pattern: "create_element\\(.*label="
---

<objective>
Convert all remaining Python test files to kwargs API and update CLAUDE.md documentation.

Purpose: Complete the test migration started in Plan 01, ensuring the full Python test suite passes with the new API. Update project documentation to reflect the change.
Output: All 9 remaining test files converted, full test suite green, CLAUDE.md updated.
</objective>

<execution_context>
@C:/Users/rsampaio/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/rsampaio/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-python-kwargs-api/01-CONTEXT.md
@.planning/phases/01-python-kwargs-api/01-RESEARCH.md
@.planning/phases/01-python-kwargs-api/01-01-SUMMARY.md

<interfaces>
<!-- After Plan 01, the kwargs API is established in database.py -->
```python
# New signatures (from Plan 01):
def create_element(self, collection: str, **kwargs: object) -> int: ...
def update_element(self, collection: str, id: int, **kwargs: object) -> None: ...
```

<!-- Conversion patterns (same rules as Plan 01 Task 2): -->
```python
# Chained pattern:
# BEFORE: db.create_element("Coll", Element().set("label", "x").set("value", 42))
# AFTER:  db.create_element("Coll", label="x", value=42)

# Non-chained pattern (CSV test files):
# BEFORE: e1 = Element(); e1.set("label", "x"); e1.set("value", 42); db.create_element("Coll", e1)
# AFTER:  db.create_element("Coll", label="x", value=42)

# Update pattern:
# BEFORE: db.update_element("Coll", id, Element().set("value", 99))
# AFTER:  db.update_element("Coll", id, value=99)

# Helper function pattern (time_series):
# BEFORE: def _create_sensor(db, label): db.create_element("Sensor", Element().set("label", label))
# AFTER:  def _create_sensor(db, label): return db.create_element("Sensor", label=label)
```
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Convert remaining test files from Element to kwargs</name>
  <files>
    bindings/python/tests/test_database_read_scalar.py
    bindings/python/tests/test_database_read_vector.py
    bindings/python/tests/test_database_read_set.py
    bindings/python/tests/test_database_query.py
    bindings/python/tests/test_database_transaction.py
    bindings/python/tests/test_database_csv_export.py
    bindings/python/tests/test_database_csv_import.py
    bindings/python/tests/test_database_time_series.py
    bindings/python/tests/test_database_metadata.py
  </files>
  <action>
Convert all 9 remaining test files from Element builder pattern to kwargs API. Apply the same mechanical conversion rules as Plan 01 Task 2.

**For each file:**

1. Remove `Element` from imports. If the import is `from quiverdb import Database, Element`, change to `from quiverdb import Database`. If only `Element` is imported, remove the entire import line.

2. Convert all `Element()` usage to kwargs syntax.

**File-specific notes:**

**test_database_read_scalar.py (~25 occurrences):**
- Setup elements for read tests use chained Element pattern
- Convert to kwargs on create_element calls

**test_database_read_vector.py (~22 occurrences):**
- Same pattern as read_scalar — chained Element().set() in setup

**test_database_read_set.py (~25 occurrences):**
- Same pattern as read_scalar/vector — chained Element().set() in setup

**test_database_query.py (~15 occurrences):**
- Setup elements for query tests, chained pattern

**test_database_transaction.py (~11 occurrences):**
- Transaction tests with Element in create/update calls inside transaction blocks

**test_database_csv_export.py (~11 occurrences) — NON-CHAINED PATTERN:**
- Uses sequential `e1 = Element(); e1.set("label", "Item1"); e1.set("name", "Alpha"); db.create_element("Items", e1)`
- Convert to: `db.create_element("Items", label="Item1", name="Alpha")`
- Multiple sequential e.set() calls per element — gather all attributes into one kwargs call

**test_database_csv_import.py (~8 occurrences) — NON-CHAINED PATTERN:**
- Same non-chained pattern as csv_export
- Convert sequential e.set() blocks to single create_element kwargs call

**test_database_time_series.py (~2 occurrences):**
- Helper functions `_create_sensor` and/or `_create_collection_element` use Element
- Convert helper function bodies to use kwargs
- Example: `db.create_element("Sensor", Element().set("label", label))` becomes `db.create_element("Sensor", label=label)`

**test_database_metadata.py (~1 occurrence):**
- Single Element usage, likely in test setup — convert to kwargs

**CRITICAL:** After conversion, grep each file for any remaining `Element` references (including in comments that reference the class name in a way that suggests code). The word "Element" in docstrings describing what the test does is fine. Leftover `Element()` constructor calls or `.set(` method calls are bugs.
  </action>
  <verify>
    <automated>cd C:/Development/DatabaseTmp/quiver2 && python -m pytest bindings/python/tests/test_database_read_scalar.py bindings/python/tests/test_database_read_vector.py bindings/python/tests/test_database_read_set.py bindings/python/tests/test_database_query.py bindings/python/tests/test_database_transaction.py bindings/python/tests/test_database_csv_export.py bindings/python/tests/test_database_csv_import.py bindings/python/tests/test_database_time_series.py bindings/python/tests/test_database_metadata.py -x -v</automated>
  </verify>
  <done>
    - All 9 test files pass
    - No test file imports Element from quiverdb public package
    - No remaining Element() constructor calls in any test file (except test_element.py which uses internal import)
    - Non-chained patterns in CSV test files correctly converted
    - Helper functions in time_series tests correctly converted
  </done>
</task>

<task type="auto">
  <name>Task 2: Update CLAUDE.md cross-layer naming tables for Python kwargs pattern</name>
  <files>
    CLAUDE.md
  </files>
  <action>
Update CLAUDE.md to reflect the Python kwargs API change. Three specific areas:

**1. Cross-Layer Naming Conventions — Transformation Rules table (~line 395):**

Update the Python column description (line ~403) from:
```
- **C++ to Python:** Same `snake_case` name. Factory methods are `@staticmethod`: `from_schema` -> `Database.from_schema()`. Properties are regular methods (not `@property`).
```
To:
```
- **C++ to Python:** Same `snake_case` name. Factory methods are `@staticmethod`: `from_schema` -> `Database.from_schema()`. Properties are regular methods (not `@property`). Create/update use `**kwargs`: `create_element("Collection", label="x")`.
```

**2. Representative Cross-Layer Examples table (~line 408):**

Update the Create row to show the kwargs pattern for Python. Add a note or adjust the table to clarify that Python's `create_element` uses kwargs (not a positional Element):

| Create | `create_element()` | `quiver_database_create_element()` | `create_element!()` | `createElement()` | `create_element()` |

The table cell values don't change (the method names are the same), but add a footnote or comment that Python's `create_element` accepts `**kwargs` not an Element positional argument.

**3. Bindings section — Python Notes (~line 484):**

Add a note about the kwargs API:
```
- `create_element` and `update_element` accept `**kwargs` (not an Element builder). Element class is internal.
- Dict unpacking supported: `db.create_element("Collection", **my_dict)`
```

**4. Core API section — Element Class description:**

Add a note that in Python, Element is internal-only (not part of public API). The Element class description currently says "Builder for element creation with fluent API" — add a clarification that Python users use kwargs instead.

Do NOT change any other language's documentation. Do NOT change the C++ or C API sections.
  </action>
  <verify>
    <automated>cd C:/Development/DatabaseTmp/quiver2 && grep -n "kwargs" CLAUDE.md | head -10 && grep -n "Element.*internal" CLAUDE.md | head -5</automated>
  </verify>
  <done>
    - CLAUDE.md transformation rules mention Python kwargs pattern
    - CLAUDE.md Python Notes section documents kwargs API and dict unpacking
    - No other language sections modified
    - Accurate reflection of the new Python pattern
  </done>
</task>

</tasks>

<verification>
1. Run full Python test suite: `cd C:/Development/DatabaseTmp/quiver2 && python -m pytest bindings/python/tests/ -x -v`
   ALL tests pass (this is the definitive check for PYAPI-04).
2. Grep for Element imports in test files: `grep -rn "from quiverdb import.*Element" bindings/python/tests/` should return ONLY test_element.py (which uses internal import `from quiverdb.element import Element`).
3. CLAUDE.md contains "kwargs" in the Python-related sections.
</verification>

<success_criteria>
- Full Python test suite passes (`python -m pytest bindings/python/tests/ -x -v` = all green)
- Zero test files import Element from quiverdb public API
- CLAUDE.md accurately documents the Python kwargs pattern
- Non-chained Element patterns (CSV tests) correctly converted
- Helper functions (time series tests) correctly converted
</success_criteria>

<output>
After completion, create `.planning/phases/01-python-kwargs-api/01-02-SUMMARY.md`
</output>
