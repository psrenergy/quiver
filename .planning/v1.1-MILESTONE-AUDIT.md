---
milestone: v1.1
audited: 2026-02-24T19:00:00Z
status: gaps_found
scores:
  requirements: 6/8
  phases: 3/4
  integration: 6/6
  flows: 2/2
gaps:
  requirements:
    - id: "LUA-01"
      status: "unsatisfied"
      phase: "Phase 8 (Lua FK Tests)"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 8 has no directory, no plans, no execution. LUA-01 is mapped in REQUIREMENTS.md traceability table but absent from all phase VERIFICATION.md files."
    - id: "LUA-02"
      status: "unsatisfied"
      phase: "Phase 8 (Lua FK Tests)"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 8 has no directory, no plans, no execution. LUA-02 is mapped in REQUIREMENTS.md traceability table but absent from all phase VERIFICATION.md files."
  integration: []
  flows: []
tech_debt: []
---

# Milestone v1.1 FK Test Coverage — Audit Report

**Audited:** 2026-02-24T19:00:00Z
**Status:** gaps_found
**Score:** 6/8 requirements satisfied

## Milestone Definition of Done

Mirror all 16 C++ FK resolution tests across C API, Julia, Dart, and Lua to ensure FK label resolution is tested end-to-end through every binding layer.

## Phase Verification Summary

| Phase | Name | Status | Score | Verified |
|-------|------|--------|-------|----------|
| 5 | C API FK Tests | passed | 16/16 | 2026-02-24 |
| 6 | Julia FK Tests | passed | 5/5 | 2026-02-24 |
| 7 | Dart FK Tests | passed | 16/16 | 2026-02-24 |
| 8 | Lua FK Tests | **UNVERIFIED** | — | Phase not started |

All completed phases (5-7) passed verification with zero gaps, zero anti-patterns, and zero critical issues.

Phase 8 has no directory, no plans, and no VERIFICATION.md — this is a blocker.

## Requirements Coverage (3-Source Cross-Reference)

| REQ-ID | Description | Phase | VERIFICATION.md | SUMMARY Frontmatter | REQUIREMENTS.md | Final Status |
|--------|-------------|-------|-----------------|---------------------|-----------------|-------------|
| CAPI-01 | C API FK create tests (9 cases) | Phase 5 | SATISFIED | — | `[x]` Complete | **satisfied** |
| CAPI-02 | C API FK update tests (7 cases) | Phase 5 | SATISFIED | — | `[x]` Complete | **satisfied** |
| JUL-01 | Julia FK create tests (9 cases) | Phase 6 | SATISFIED | — | `[x]` Complete | **satisfied** |
| JUL-02 | Julia FK update tests (7 cases) | Phase 6 | SATISFIED | — | `[x]` Complete | **satisfied** |
| DART-01 | Dart FK create tests (9 cases) | Phase 7 | SATISFIED | listed (07-01) | `[x]` Complete | **satisfied** |
| DART-02 | Dart FK update tests (7 cases) | Phase 7 | SATISFIED | — | `[x]` Complete | **satisfied** |
| LUA-01 | Lua FK create tests (9 cases) | Phase 8 | **missing** | missing | `[ ]` Pending | **unsatisfied** |
| LUA-02 | Lua FK update tests (7 cases) | Phase 8 | **missing** | missing | `[ ]` Pending | **unsatisfied** |

**Orphan check:** No orphaned requirements. All 8 REQ-IDs in the traceability table are assigned to phases. LUA-01 and LUA-02 are assigned to Phase 8 but that phase has not been executed.

## Cross-Phase Integration

Integration checker verified all completed phases (5-7):

- **Wiring:** 6/6 cross-phase connections properly established
- **E2E Flows:** 2/2 flows traced end-to-end (create FK resolution, update FK resolution)
- **Broken Flows:** 0
- **Orphaned Exports:** 0

### Test Case Parity Across Layers

All three completed binding layers implement exactly 9 create tests and 7 update tests with matching semantics:

| # | C API | Julia | Dart |
|---|-------|-------|------|
| C1 | ResolveFkLabelInSetCreate | Resolve FK Label In Set Create | resolves set FK labels to IDs |
| C2 | ResolveFkLabelMissingTarget | Resolve FK Label Missing Target | throws on missing FK target label |
| C3 | RejectStringForNonFkIntegerColumn | Reject String For Non-FK Integer Column | throws on string for non-FK integer column |
| C4 | CreateElementScalarFkLabel | Create Element Scalar FK Label | resolves scalar FK labels to IDs |
| C5 | CreateElementVectorFkLabels | Create Element Vector FK Labels | resolves vector FK labels to IDs |
| C6 | CreateElementTimeSeriesFkLabels | Create Element Time Series FK Labels | resolves time series FK labels to IDs |
| C7 | CreateElementAllFkTypesInOneCall | Create Element All FK Types In One Call | resolves all FK types in one call |
| C8 | CreateElementNoFkColumnsUnchanged | Create Element No FK Columns Unchanged | non-FK integer columns pass through unchanged |
| C9 | ScalarFkResolutionFailureCausesNoPartialWrites | Scalar FK Resolution Failure Causes No Partial Writes | zero partial writes on resolution failure |

| # | C API | Julia | Dart |
|---|-------|-------|------|
| U1 | UpdateElementScalarFkLabel | Update Element Scalar FK Label | resolves scalar FK labels to IDs |
| U2 | UpdateElementVectorFkLabels | Update Element Vector FK Labels | resolves vector FK labels to IDs |
| U3 | UpdateElementSetFkLabels | Update Element Set FK Labels | resolves set FK labels to IDs |
| U4 | UpdateElementTimeSeriesFkLabels | Update Element Time Series FK Labels | resolves time series FK labels to IDs |
| U5 | UpdateElementAllFkTypesInOneCall | Update Element All FK Types In One Call | resolves all FK types in one call |
| U6 | UpdateElementNoFkColumnsUnchanged | Update Element No FK Columns Unchanged | non-FK integer columns pass through unchanged |
| U7 | UpdateElementFkResolutionFailurePreservesExisting | Update Element FK Resolution Failure Preserves Existing | failure preserves existing data |

All layers share test schemas: `tests/schemas/valid/relations.sql` (FK) and `tests/schemas/valid/basic.sql` (no-FK regression).

### Error Handling Consistency

All three layers follow the same error strategy:
- C API: returns `QUIVER_ERROR`, checks return code only
- Julia: `@test_throws Quiver.DatabaseException` — type check only
- Dart: `throwsA(isA<DatabaseException>())` — type check only

Error messages are owned by the C++ layer; bindings never inspect message content.

## Tech Debt

No tech debt items across any completed phase. All verification reports found zero TODO/FIXME/HACK/placeholder patterns.

## Test Suite Health

| Layer | Tests | Status |
|-------|-------|--------|
| C++ core | 442 | All pass |
| C API | 287 | All pass |
| Julia | 459 | All pass (human verification recommended) |
| Dart | 248+ | All pass |

## Unsatisfied Requirements Detail

### LUA-01: Lua FK create tests (Phase 8)

**Description:** Lua FK resolution tests for create_element cover all 9 test cases mirroring C++ create path.
**Phase:** Phase 8 (Lua FK Tests) — not started.
**Blocker:** Phase 8 has no directory, no plans, no execution. LUA-01 appears in REQUIREMENTS.md traceability (line 52) but is absent from all phase VERIFICATION.md files.

### LUA-02: Lua FK update tests (Phase 8)

**Description:** Lua FK resolution tests for update_element cover all 7 test cases mirroring C++ update path.
**Phase:** Phase 8 (Lua FK Tests) — not started.
**Blocker:** Phase 8 has no directory, no plans, no execution. LUA-02 appears in REQUIREMENTS.md traceability (line 53) but is absent from all phase VERIFICATION.md files.

---

*Audited: 2026-02-24T19:00:00Z*
*Auditor: Claude (audit-milestone)*
